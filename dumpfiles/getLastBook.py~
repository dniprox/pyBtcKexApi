#!/usr/bin/env python2
import sys
import krakenex
import json
import datetime
import matplotlib.mlab as mlab
import matplotlib.pyplot as plt
import pylab as p

def print_time(timestamp):
    return datetime.datetime.fromtimestamp(int(timestamp)).strftime('%Y%m%d-%H%M%S')

def send_query(entries):    
    k = krakenex.API()
    return k.query_public('Depth', {'pair': 'XXBTZEUR','count':entries})

number_of_entries=200
json_query_string=send_query(number_of_entries)

#print json_query_string
#json_dump=json.dumps(json_query_string, sort_keys=True, indent=4, separators=(',',': '))

#print json_dump

ask = []
askvol = []
asktime = []
bid = []
bidvol = []
bidtime = []


for i in range(0,number_of_entries):
    #print i
    ask.append(json_query_string['result']['XXBTZEUR']['asks'][i][0])
    askvol.append(json_query_string['result']['XXBTZEUR']['asks'][i][1])
    asktime.append(json_query_string['result']['XXBTZEUR']['asks'][i][2])

    bid.append(json_query_string['result']['XXBTZEUR']['bids'][i][0])
    bidvol.append(json_query_string['result']['XXBTZEUR']['bids'][i][1])
    bidtime.append(json_query_string['result']['XXBTZEUR']['bids'][i][2])


    #print ask

for i in reversed(range(0,number_of_entries)):
    print "Time:",print_time(asktime[i])," Ask:",ask[i]," Vol:",askvol[i]

print "---------------------------------------------"

for i in range(0,number_of_entries):
    print "Time:",print_time(bidtime[i])," Bid:",bid[i]," Vol:",bidvol[i]


x = []
y = []
for p in ask:
    x.append(p)

for p in bid:
    x.append(p)

for v in askvol:
    y.append(v)

for v in bidvol:
    y.append(v)

#print x
#print y

plt.scatter(x,y,s=5)
plt.show()
